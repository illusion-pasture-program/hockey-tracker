<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hockey Tracker</title>
    <style>
        :root {
            --home-color: #2a5298;
            --away-color: #c62828;
            --bg-color: #1e3c72;
            --text-dark: #333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header */
        header {
            text-align: center;
            color: white;
            padding: 10px 0;
            font-size: 1.2rem;
            font-weight: bold;
            flex-shrink: 0;
        }

        /* Main Card Container */
        .tracker-card {
            background: white;
            flex-grow: 1;
            margin: 0 15px 20px 15px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        /* Top Row: Teams & Period */
        .top-row {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            margin-bottom: 5px;
        }

        .team-name {
            font-size: 1.3rem;
            font-weight: 800;
            text-align: center;
            cursor: pointer;
            line-height: 1.2;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .team-name.home { color: var(--home-color); }
        .team-name.away { color: var(--away-color); }

        .period-btn {
            background: #e8eaf6;
            color: #1e3c72;
            font-weight: bold;
            border: 1px solid #c5cae9;
            padding: 5px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
        }

        /* Stats Row (SV, SV%, Penalties) */
        .stats-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            margin-bottom: 15px;
        }

        .stat-detail {
            text-align: center;
            font-size: 0.85rem;
            font-weight: 600;
            font-family: monospace;
            white-space: nowrap;
        }

        .stat-detail.home { color: var(--home-color); }
        .stat-detail.away { color: var(--away-color); }

        /* Game Buttons Grid */
        .game-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto 1fr; /* Goals auto height, Shots fill rest */
            gap: 15px;
            flex-grow: 1;
            height: 100%;
        }

        /* Button Styles */
        .stat-btn {
            border: none;
            border-radius: 12px;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.1s, filter 0.2s;
            position: relative;
            width: 100%;
        }

        .stat-btn:active {
            transform: scale(0.98);
            filter: brightness(0.9);
        }

        .stat-btn.home { background-color: var(--home-color); }
        .stat-btn.away { background-color: var(--away-color); }

        /* Specific Sizes */
        .btn-goals {
            aspect-ratio: 1.5 / 1; 
        }
        
        .btn-shots {
            height: 100%; 
        }

        /* Typography inside buttons */
        .label {
            font-size: 1rem;
            font-weight: 600;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .value {
            font-size: 3.5rem;
            font-weight: 900;
            line-height: 1;
            font-family: 'Arial Black', sans-serif;
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 350px;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .control-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .penalty-control {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 10px;
        }

        .penalty-btn {
            width: 40px; height: 40px;
            border-radius: 50%;
            border: none;
            background: #ddd;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
        }

        .penalty-display {
            font-size: 2rem;
            font-weight: bold;
            min-width: 40px;
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .color-opt {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .color-opt.selected { border-color: #333; transform: scale(1.1); }

        .close-btn {
            background: #333;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1rem;
            width: 100%;
            margin-top: 10px;
        }

        .reset-btn {
            background: #d32f2f;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1rem;
            width: 100%;
            margin-top: 10px;
        }

        /* Toast for Long Press hint */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.8rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        @media (max-height: 600px) {
            .value { font-size: 2.5rem; }
            .tracker-card { margin: 0 10px 10px 10px; }
        }
    </style>
</head>
<body>

    <header>
        üèí Hockey Tracker üèí
    </header>

    <div class="tracker-card">
        <!-- Top Row -->
        <div class="top-row">
            <div class="team-name home" id="homeNameBtn">Home Team</div>
            <button class="period-btn" id="periodBtn">Period: 1</button>
            <div class="team-name away" id="awayNameBtn">Away Team</div>
        </div>

        <!-- Stats Row (SV, SV%, Penalties) -->
        <div class="stats-row">
            <div class="stat-detail home" id="homeStatsLine">SV 0 SV% .000 P 0</div>
            <div class="stat-detail away" id="awayStatsLine">SV 0 SV% .000 P 0</div>
        </div>

        <!-- Main Buttons -->
        <div class="game-grid">
            <!-- Home Goals -->
            <button class="stat-btn home btn-goals" id="btnHomeGoal">
                <span class="label">Goals</span>
                <span class="value" id="valHomeGoal">0</span>
            </button>

            <!-- Away Goals -->
            <button class="stat-btn away btn-goals" id="btnAwayGoal">
                <span class="label">Goals</span>
                <span class="value" id="valAwayGoal">0</span>
            </button>

            <!-- Home Shots -->
            <button class="stat-btn home btn-shots" id="btnHomeShot">
                <span class="label">Shots on Goal</span>
                <span class="value" id="valHomeShot">0</span>
            </button>

            <!-- Away Shots -->
            <button class="stat-btn away btn-shots" id="btnAwayShot">
                <span class="label">Shots on Goal</span>
                <span class="value" id="valAwayShot">0</span>
            </button>
        </div>
    </div>

    <div class="toast" id="toast">Hold button to subtract</div>

    <!-- Settings Modal (Shared for Home/Away) -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal-content">
            <h3 class="modal-title" id="modalTitle">Team Settings</h3>
            
            <!-- Penalties -->
            <div class="control-section">
                <h4>Penalties</h4>
                <div class="penalty-control">
                    <button class="penalty-btn" id="penMinus">‚àí</button>
                    <span class="penalty-display" id="penVal">0</span>
                    <button class="penalty-btn" id="penPlus">+</button>
                </div>
            </div>

            <!-- Colors -->
            <div class="control-section">
                <h4>Jersey Color</h4>
                <div class="color-grid" id="colorGrid">
                    <!-- Generated via JS -->
                </div>
            </div>

            <button class="close-btn" onclick="closeModal()">Done</button>
            
            <div style="margin-top:20px; border-top:1px solid #eee; padding-top:15px;">
                <button class="reset-btn" onclick="resetGame()">‚ö† Reset Game ‚ö†</button>
            </div>
        </div>
    </div>

    <script>
        // --- State Management ---
        let game = {
            period: 1,
            home: { name: 'Home', score: 0, shots: 0, penalties: 0, color: '#2a5298' },
            away: { name: 'Away', score: 0, shots: 0, penalties: 0, color: '#c62828' }
        };
        
        // Current team being edited in modal
        let activeEditTeam = null; 

        const colors = [
            '#2a5298', '#c62828', '#1a237e', '#2e7d32', 
            '#212121', '#6a1b9a', '#ef6c00', '#f9a825', 
            '#0288d1', '#ffffff', '#00897b', '#616161'
        ];

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            updateDisplay();
            setupInteractions();
            setupWakeLock();
            
            // Show hint toast
            const toast = document.getElementById('toast');
            toast.style.opacity = '1';
            setTimeout(() => toast.style.opacity = '0', 3000);
        });

        // --- Core Logic ---
        
        function handleAction(team, type, delta) {
            const data = game[team];
            
            if (type === 'score') {
                const newScore = Math.max(0, data.score + delta);
                // If adding a goal, automatically add a shot
                if (delta > 0) {
                    data.score = newScore;
                    data.shots++; 
                } else {
                    // If removing a goal, assume we are correcting a mistake.
                    if (data.score > 0) {
                        data.score = newScore;
                        data.shots = Math.max(0, data.shots - 1);
                    }
                }
            } else if (type === 'shots') {
                data.shots = Math.max(data.score, data.shots + delta);
            }

            updateDisplay();
        }

        function nextPeriod() {
            if (game.period < 3) game.period++;
            else if (game.period === 3) game.period = 'OT';
            else if (game.period === 'OT') game.period = 1;
            updateDisplay();
        }

        function resetGame() {
            if(confirm("Reset all stats?")) {
                const hColor = game.home.color;
                const aColor = game.away.color;
                game = {
                    period: 1,
                    home: { name: 'Home', score: 0, shots: 0, penalties: 0, color: hColor },
                    away: { name: 'Away', score: 0, shots: 0, penalties: 0, color: aColor }
                };
                updateDisplay();
                closeModal();
            }
        }

        // --- Display Updates ---

        function updateDisplay() {
            // Text
            document.getElementById('periodBtn').textContent = `Period: ${game.period}`;
            
            // Values
            document.getElementById('valHomeGoal').textContent = game.home.score;
            document.getElementById('valAwayGoal').textContent = game.away.score;
            document.getElementById('valHomeShot').textContent = game.home.shots;
            document.getElementById('valAwayShot').textContent = game.away.shots;

            // Colors & CSS vars
            document.documentElement.style.setProperty('--home-color', game.home.color);
            document.documentElement.style.setProperty('--away-color', game.away.color);

            // Handle White jersey text visibility
            const homeText = game.home.color === '#ffffff' ? '#333' : '#fff';
            const awayText = game.away.color === '#ffffff' ? '#333' : '#fff';
            
            document.querySelectorAll('.stat-btn.home').forEach(el => el.style.color = homeText);
            document.querySelectorAll('.stat-btn.away').forEach(el => el.style.color = awayText);
            
            // Goalie & Penalty Stats Line
            // Home Goalie: Faces Away Shots, Allows Away Goals
            const hStats = calcGoalieStats(game.away.shots, game.away.score);
            document.getElementById('homeStatsLine').textContent = `SV ${hStats.saves} SV% ${hStats.pct} P ${game.home.penalties}`;

            // Away Goalie: Faces Home Shots, Allows Home Goals
            const aStats = calcGoalieStats(game.home.shots, game.home.score);
            document.getElementById('awayStatsLine').textContent = `SV ${aStats.saves} SV% ${aStats.pct} P ${game.away.penalties}`;
        }

        function calcGoalieStats(shotsAgainst, goalsAgainst) {
            const saves = Math.max(0, shotsAgainst - goalsAgainst);
            let pct = '.000';
            
            if (shotsAgainst > 0) {
                const rawPct = saves / shotsAgainst;
                if (rawPct >= 1) {
                    pct = '1.000';
                } else {
                    // Turn 0.9546 into .955
                    pct = rawPct.toFixed(3).substring(1);
                }
            }
            
            return { saves, pct };
        }

        // --- Event Listeners (Long Press Logic) ---

        function setupInteractions() {
            // Stat Buttons: Tap (+), Long Press (-)
            attachPressHandler('btnHomeGoal', () => handleAction('home', 'score', 1), () => handleAction('home', 'score', -1));
            attachPressHandler('btnAwayGoal', () => handleAction('away', 'score', 1), () => handleAction('away', 'score', -1));
            attachPressHandler('btnHomeShot', () => handleAction('home', 'shots', 1), () => handleAction('home', 'shots', -1));
            attachPressHandler('btnAwayShot', () => handleAction('away', 'shots', 1), () => handleAction('away', 'shots', -1));

            // Team Names: Long Press for Menu
            attachPressHandler('homeNameBtn', null, () => openModal('home'));
            attachPressHandler('awayNameBtn', null, () => openModal('away'));

            // Period
            document.getElementById('periodBtn').addEventListener('click', nextPeriod);

            // Modal Penalty Controls
            document.getElementById('penMinus').onclick = () => changePenalty(-1);
            document.getElementById('penPlus').onclick = () => changePenalty(1);
        }

        function attachPressHandler(id, clickAction, holdAction) {
            const el = document.getElementById(id);
            let timer;
            let isLongPress = false;
            const HOLD_MS = 500;

            const start = (e) => {
                if(e.type === 'touchstart') e.preventDefault();
                
                isLongPress = false;
                timer = setTimeout(() => {
                    isLongPress = true;
                    if(navigator.vibrate) navigator.vibrate(50);
                    if(holdAction) holdAction();
                }, HOLD_MS);
            };

            const end = (e) => {
                if(e.type === 'touchend') e.preventDefault();
                clearTimeout(timer);
                if (!isLongPress && clickAction) {
                    clickAction();
                }
            };

            const cancel = () => clearTimeout(timer);

            el.addEventListener('mousedown', start);
            el.addEventListener('touchstart', start, {passive: false});
            
            el.addEventListener('mouseup', end);
            el.addEventListener('touchend', end, {passive: false});
            
            el.addEventListener('mouseleave', cancel);
            el.addEventListener('touchcancel', cancel);
        }

        // --- Modal & Settings ---

        function openModal(team) {
            activeEditTeam = team;
            const data = game[team];
            
            document.getElementById('modalTitle').textContent = `${team === 'home' ? 'Home' : 'Away'} Team Settings`;
            document.getElementById('penVal').textContent = data.penalties;
            
            // Render Colors
            const grid = document.getElementById('colorGrid');
            grid.innerHTML = '';
            colors.forEach(c => {
                const div = document.createElement('div');
                div.className = 'color-opt';
                div.style.backgroundColor = c;
                if(c === '#ffffff') div.style.border = '2px solid #eee';
                if(c === data.color) div.classList.add('selected');
                
                div.onclick = () => {
                    game[activeEditTeam].color = c;
                    updateDisplay();
                    openModal(activeEditTeam);
                };
                grid.appendChild(div);
            });

            document.getElementById('settingsModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('settingsModal').style.display = 'none';
            activeEditTeam = null;
        }

        function changePenalty(delta) {
            if(!activeEditTeam) return;
            const val = Math.max(0, game[activeEditTeam].penalties + delta);
            game[activeEditTeam].penalties = val;
            document.getElementById('penVal').textContent = val;
            updateDisplay();
        }

        // --- Wake Lock (Keep Screen On) ---
        async function setupWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    let wakeLock = null;
                    const requestLock = async () => {
                        try {
                            wakeLock = await navigator.wakeLock.request('screen');
                        } catch (err) {
                            console.log(`${err.name}, ${err.message}`);
                        }
                    };
                    
                    document.addEventListener('click', requestLock, { once: true });
                    document.addEventListener('visibilitychange', async () => {
                        if (wakeLock !== null && document.visibilityState === 'visible') {
                            requestLock();
                        }
                    });
                }
            } catch (e) {
                console.log('Wake lock not supported');
            }
        }

    </script>
</body>
</html>
